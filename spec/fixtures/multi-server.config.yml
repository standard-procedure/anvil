version: 0.1
hosts:
  - server1.example.com:
      env:
        - PRIMARY=true
  - server2.example.com:
app:
  hostname: app.example.com
  port: 3000
  environment:
    - ENV_VAR=value
    - ENV_VAR2=value2
    - RAILS_ENV=production
  secrets: spec/fixtures/secrets.yml
  resource_limit: 2048m
  scale: web=2 worker=1
  nginx:
    forward_proxy_headers: false
    client_max_body_size: 512m
    proxy_read_timeout: 60s
  scripts:
    after_intall:
      all:
        - dokku cron-restart:set app schedule '0 3 * * *'
        - dokku letsencrypt:set app email ssl-admin@mycompany.com
        - dokku letsencrypt:enable app
    after_deploy:
      primary:
        - dokku run app bin/rails db:migrate
